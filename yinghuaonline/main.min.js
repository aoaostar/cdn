var aoaostar_player=null;const UPDATE_TIME="2022年1月26日11:05:29";var videoIsOver=!1;const aoaostar_storage={set:function(e,t){if(window.localStorage)window.localStorage.setItem(e,t);else{var o=new Date;o.setTime(o.getTime()+2592e6),document.cookie=e+"="+escape(t)+";expires="+o.toGMTString()}},get:function(e){if(window.localStorage)return window.localStorage.getItem(e);var t,o=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(o))?unescape(t[2]):null},del:function(e){if(window.localStorage)return window.localStorage.removeItem(e);var t=new Date;t.setTime(t.getTime()-1);var o=this.get(e);null!=o&&(document.cookie=e+"="+o+";expires="+t.toGMTString())}},aoaostar={player:null,idList:[],nodeId:0,courseId:0,mainInterval:null,initialize:function(){if(this.nodeId=getQueryVariable("nodeId"),this.idList=this.getIdList(),this.courseId=this.getCourseId(),this.player=aoaostar_player,window.console&&window.console.log){console.clear();this.player.getMetaDate();console.log("%c 傲星英华学堂网课助手 %c https://www.aoaostar.com ","color: #fadfa3; background: #030307; padding:5px 0;","background: #fadfa3; padding:5px 0;"),console.log("%c 最后更新时间："+UPDATE_TIME+" ","color: #fff; margin: 1em 0; padding: 5px 0; background: #3498db;"),console.log(`%c 当前课程ID：${this.courseId} %c 章节ID：${this.nodeId}`,"background: #35495e; padding: 4px; border-radius: 3px 0 0 3px; color: #fff","background: #41b883; padding: 4px; border-radius: 0 3px 3px 0; color: #fff"),console.log("%c 脚本加载完成 当前时间："+(new Date).toLocaleString(),"color: #fff; margin: 1em 0; padding: 5px 0; background: #636e72;")}},main:function(){if(!this.judgementState())return;let e=this;null==document.getElementById("videoContent")&&e.isOver()&&aoaostar_print("恭喜你，已全部刷完"),this.mainInterval=setInterval((()=>{aoaostar_print("播放状态检查，是否播放完成："+videoIsOver),!0===videoIsOver&&e.over()}),3e3)},getCourseId:function(){let e=document.querySelector(".wrapper .curPlace .center");return null==e?(e=window.location.href,this.courseId=getQueryVariable("courseId",e)):this.courseId=getQueryVariable("courseId",e.lastChild.href),!1===getQueryVariable("courseId")&&(window.location.href=this.getFullUrl(this.nodeId)),this.courseId},over:function(){if(aoaostar_print("播放完成"),aoaostar_print("视频长度为"+this.player.getMetaDate().duration+"秒"),this.isOver())aoaostar_print("恭喜你，已全部刷完"),clearInterval(this.mainInterval);else{aoaostar_print("2秒后跳转下一部");let e=this;setTimeout((function(){window.location.href=e.getFullUrl(e.getNextId())}),2e3)}},judgementState(){let e=this;return null!=document.getElementById("error-main")?"章节数据有误,联系老师!"===document.querySelector("#error-main .name").innerText?(aoaostar_print("章节数据有误,准备跳转下一部"),setTimeout((function(){window.location.href=this.getFullUrl(this.getNextId())}),2e3),!1):"当前章节尚未解锁，请先学完上一个视频"===document.querySelector("#error-main .name").innerText&&(aoaostar_print("当前章节尚未解锁，准备跳转上一部"),setTimeout((function(){window.location.href=e.getFullUrl(e.getLastId())}),2e3),!1):this.idList[this.idList.length-1]===this.nodeId?(aoaostar_print("恭喜你，当前为最后一课"),!0):null!=document.getElementById("videoContent")||(aoaostar_print("当前页面没有发现播放信息，准备跳转下一部"),setTimeout((function(){window.location.href=e.getFullUrl(e.getNextId())}),2e3),!1)},getIdList:function(){const e=document.querySelectorAll(".two .list .item a");let t=[];for(let o=0;o<e.length;o++){let a=e[o].getAttribute("href"),n=a.substring(a.lastIndexOf("nodeId=")+7);t.push(n)}return t},getLastId:function(){for(var e in this.idList)if(this.idList[e]===this.nodeId)return this.idList[parseInt(e)-1];return aoaostar_print("获取上一个Id失败"),this.nodeId},getNextId:function(){for(var e in this.idList)if(this.idList[e]===this.nodeId)return this.idList[parseInt(e)+1];return aoaostar_print("获取下一个Id失败"),this.nodeId},getNearId:function(){for(const e in this.idList)if(this.idList[e]>this.nodeId&&0!==e)return this.idList[parseInt(e)-1];return aoaostar_print("获取最近Id失败，跳转第一课"),this.idList[0]},isOver:function(){return this.idList[this.idList.length-1]===this.nodeId},getFullUrl:function(e){return`${window.location.origin}/user/node?courseId=${this.courseId}&nodeId=${e}&t=${(new Date).getTime()}`}};function aoaostar_print(e){window.console&&window.console.log&&console.log("%c "+e,"color: #fff; margin: 1em 0; padding: 5px 0; background: #222f3e;")}function getQueryVariable(e,t=null){var o=window.location.search.substring(1);null!=t&&(t.substr(t.indexOf("?")+1),o=t.substr(t.indexOf("?")+1));for(var a=o.split("&"),n=0;n<a.length;n++){var r=a[n].split("=");if(r[0]===e)return r[1]}return!1}!function(){var e=$("#video-file").val()||"",t=$("#video-nodeId").val()||"",o=$("#user-id").val()||"0",a=$("#study-state").val()||0;a=parseInt(a);var n="/user/node/study",r=0,i=0,d=0,s="stop",l="node_"+o+"_"+t;window.setInterval((function(){aoaostar_storage.set("node_play_"+o,t)}),567),window.setInterval((function(){aoaostar_storage.get("node_play_"+o);"playing"===s&&i++}),1e3);var u=2===a,c=null,g="",p=function(e,o){d=i;let a={nodeId:t,studyId:r,studyTime:i};o&&(o.length>4&&(o=o.substr(0,4)),a.code=o+g),void 0!==e&&1===e&&i<1&&(a.studyTime=1),$.ajax({method:"post",url:n,data:a,dataType:"json"}).then((e=>(o&&(e.status?aoaostar_print("验证码正确"):aoaostar_print("验证码错误")),e.status&&(r=e.studyId,o?(s="playing",aoaostar_player.videoPlay()):"提交学时成功!"!==e.msg&&window.location.reload()),e))).then((e=>{e.need_code&&(s="pause",aoaostar_player.videoPause(),null===c&&(c=1,aoaostar_print(e.msg),aoaostar_print("识别验证码中，请稍后，可能需要多次请求才能成功，稍安勿躁"),fetch("/service/code?r="+Math.random()).then((function(e){return e.blob()})).then((e=>{let t=new FormData;t.append("file",e),fetch("https://api.v8cdn.cc/captcha/recognize",{method:"post",body:t,mode:"cors"}).then((e=>e.json())).then((t=>{let o=new FileReader;o.onload=()=>{console.log(`%c %c 识别结果 %c ${t.data} `,`padding: 40px 120px;background-image: url(${o.result});background-size: contain;background-repeat: no-repeat;color: transparent;`,"background: #35495e; padding: 4px; border-radius: 3px 0 0 3px; color: #fff","background: #41b883; padding: 4px; border-radius: 0 3px 3px 0; color: #fff")},o.readAsDataURL(e),g="_",p(1,t.data),c=null})).catch((e=>{console.log(e)}))}))))}))};window.addEventListener("unload",(function(e){var o=new FormData,a={nodeId:t,studyId:r,studyTime:i,closeSend:1};for(var d in a)o.append(d,a[d]);window.navigator.sendBeacon(n,o)}));var f=1e4;"function"==typeof window.navigator.sendBeacon&&(f=3e4),window.setInterval((function(){null==aoaostar_player||i<=d||p()}),f),window.loadHandler=function(){aoaostar_player.addListener("play",(function(){s="playing",0===r&&p(1),u||(u=!0)})),aoaostar_player.addListener("pause",(function(){s="pause",p()})),aoaostar_player.addListener("ended",(function(){s="ended",aoaostar_storage.del(l),p(),aoaostar_player.changeConfig("config","timeScheduleAdjust",1),videoIsOver=!0})),aoaostar_player.addListener("time",(function(e){aoaostar_storage.set(l,e)})),a<2&&aoaostar_player.changeConfig("config","timeScheduleAdjust",1)};var h={container:"#videoContent",variable:"player",drag:"start",loaded:"loadHandler",autoplay:!0,flashplayer:!1,volume:0,video:[[e,"video/mp4","中文标清",0]]},I=aoaostar_storage.get(l);I||(I=0),I>0&&(h.seek=I),aoaostar_player=new ckplayer(h),aoaostar.initialize(),aoaostar.main()}();