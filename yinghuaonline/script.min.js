// @license      GPL-3.0 License
!function(){$((function(){if(!t())return;const n=setInterval((()=>{$(".layui-layer-content").text().includes("您可能是第一次登录系统")&&(layer.closeAll(),clearInterval(n))}),500);window.location.pathname.match("/user/node")&&(!function(){GM_addElement("link",{href:"//cdn.aoaostar.com/yinghuaonline/style.css?v="+GM_info.script.version,rel:"stylesheet"});const n=`<span class="aoaostar-drawer-guide" style="">👈</span>\n<div class="aoaostar" style="display: none">\n    <div class="info">\n        <div class="title">\n            <h1>傲星英华学堂网课助手</h1>\n            <a class="link" href="https://www.aoaostar.com" target="_blank">https://www.aoaostar.com</a>\n        </div>\n        <div class="flex justify-center">\n            <a class="tag" href="https://github.com/aoaostar" target="_blank">\n                <span>作者</span><span>Pluto</span>\n            </a>   \n            <a class="tag" href="https://github.com/aoaostar/cdn/tree/master/yinghuaonline" target="_blank">\n                <span>版本号</span><span>v${GM_info.script.version||"获取失败"}</span>\n            </a>   \n        </div>\n        <div class="flex justify-center">\n            <div class="tag">\n                <span>当前课程ID</span><span id="course-id">正在获取</span>\n            </div>\n            <div class="tag">\n                <span>当前章节ID</span><span id="node-id">正在获取</span>\n            </div>\n        </div>\n        <div class="flex justify-center">\n            <div class="tag">\n                <span>视频总数</span><span id="node-count">正在获取</span>\n            </div>\n            <div class="tag">\n                <span>视频时长</span><span id="course-duration">正在获取</span>\n            </div>\n        </div>\n        <div class="flex justify-center">\n            <div class="tag">\n                <span>当前第n个视频</span><span id="node-index">正在获取</span>\n            </div>\n            <div class="tag">\n                <span>剩余视频</span><span id="node-surplus">正在获取</span>\n            </div>\n        </div>\n        <div class="tag justify-center">\n            <span>课程名称</span><span id="course-title">正在获取</span>\n        </div>\n        <div class="flex justify-center">\n            <div class="tag">\n                <span>状态</span><span id="node-status">正在获取</span>\n            </div>\n            <div class="tag">\n                <span>进度</span><span id="node-progress">正在获取</span>\n            </div>\n        </div>\n    </div>\n    <div class="output"></div>\n</div>`;$(document.body).append(n)}(),aoaostar_main()),window.location.pathname.match("/user/login")&&GM_getValue("menu_force_login",!0)&&(GM_addStyle("#code_row{display:none;}"),$("#login-title").text("学生登录（已开启封号强登）"),$("#loginForm > .list > .item:last-child").html('<div class="inpbox">\n                                <input type="button" class="btn" id="force_login" value="强制登录"/>\n                            </div>'),$("#loginForm").off(),$("#force_login").click(a),$("#password").keydown((n=>{13===n.keyCode&&(n.preventDefault(),$("#force_login").click())})))}));const n=[{title:(GM_getValue("menu_force_login",!0)?"✅":"❌")+" 强制登录（封号强登）",func:function(){GM_setValue("menu_force_login",!GM_getValue("menu_force_login",!0)),notification("切换成功"),location.reload()}},{title:(t()?"🍁 删除":"🍀 添加")+"平台",func:function(){const n=t();let a=new Set(GM_getValue("platforms_data",[]));n?a.delete(document.domain):a.add(document.domain),GM_setValue("platforms_data",[...a]),notification((n?"删除":"添加")+"平台成功"),location.reload()}},{title:"💬 反馈 & 建议 [Github]",func:function(){window.open("https://github.com/aoaostar/cdn/issues")}}];function a(){const n=$("#username").val()||"",a=$("#password").val()||"",t=$("#schoolId").val()||"";$("#remember").is(":checked")&&window.localStorage&&(localStorage.setItem("schoolId",t),localStorage.setItem("userName",n),localStorage.setItem("passWord",a),localStorage.setItem("remember","1"));let s={platform:"Android",username:n,password:a,pushId:"140fe1da9e67b9c14a7",schoolId:t,imgSign:"533560501d19cc30271a850810b09e3e",imgCode:"cryd"},e=new FormData;for(const n in s)e.append(n,s[n]);GM_xmlhttpRequest({method:"POST",url:"/api/login.json",data:e,onload:function(n){if(4===n.readyState&&200===n.status){const a=JSON.parse(n.responseText);if(a.status){let n=document.domain.split("."),t=document.domain;n.length>2&&(t=n.slice(1).join(".")),document.cookie=`token=${escape(a.result.data.token)}; domain=${t}; path=/`,notification("强制登录成功"),window.location.href="/user"}else notification("登录失败！"+a.msg)}}})}function t(){return new Set(GM_getValue("platforms_data",[])).has(document.domain)}!function(){for(const a of n)GM_registerMenuCommand(a.title,a.func)}()}();