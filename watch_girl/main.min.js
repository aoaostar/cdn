const API_URL=GM_getValue("API_URL",""),MenuCommands=[{title:(API_URL?"🍀 已":"🍁 未")+"设置API",func:function(){let t=prompt("请输入API地址",API_URL).trim();try{new URL(t)}catch(t){return void $message.error("请输入有效的API地址")}GM_setValue("API_URL",t.replace(/\/+$/g,"")),location.reload()}},{title:"💬 反馈 & 建议 [Github]",func:function(){GM_openInTab("https://github.com/aoaostar/cdn/issues")}}];function register_menu_command(){for(const t of MenuCommands)GM_registerMenuCommand(t.title,t.func)}register_menu_command();const $message={success:t=>Swal.fire({icon:"success",title:t}),error:t=>Swal.fire({icon:"error",title:t}),loading:t=>{let a=Swal.fire({title:t,allowOutsideClick:!1});return Swal.showLoading(),a}};function push_to_watch_girl(t,a){console.log({API_URL:API_URL,data:t,task_type:a});const s=$message.loading("玩命提交中");GM_xmlhttpRequest({url:API_URL+"/ajax/task",method:"post",headers:{"Content-Type":"application/json"},data:JSON.stringify({data:t,task_type:a}),onload:t=>{console.log(t),s.close();try{if(200!==t.status)return void $message.error(t.statusText);if("ok"===(t=JSON.parse(t.response)).status)return void $message.success("提交成功");$message.error(t.message)}catch(t){$message.error(t.message)}},onerror:t=>{console.log(t),s.close(),$message.error(t.message)}})}function add_list_task(){const t=$(".actor-section-name").text();let a=new URL(window.location.href),s=a.searchParams.get("t");!s||s.split(",").includes("d")?push_to_watch_girl({url:a.toString(),filepath:t,filename:""},"list"):$message.warn("有且仅含磁力的页面方可提交")}function add_detail_task(){let t=new URL(window.location.href),a=t.searchParams.get("t");!a||a.split(",").includes("d")?push_to_watch_girl({url:t.toString(),filepath:"",filename:""},"detail"):$message.warn("有且仅含磁力的页面方可提交")}function add_aria2_task(t,a,s,n){push_to_watch_girl({url:t,src_url:n,filepath:a,filename:s},"aria2")}$(".section-addition > div").addClass("has-addons").append('<p id="add_list_task" class="control">\n          <button class="button is-link" title="提交到看板(片)娘">\n            <span class="icon is-small">\n              <i class="icon-heart-o"></i>\n            </span>\n            <span>提交到看板(片)娘</span>\n</button>        </p>'),$(".movie-panel-info > .review-buttons").append('\n<div class="panel-block">\n<button class="button is-link add_detail_task" title="提交到看板(片)娘">\n            <span class="icon is-small">\n              <i class="icon-heart-o"></i>\n            </span>\n            <span>提交到看板(片)娘</span>\n</button>\n</div>'),$(".movie-list .item").append('\n<button class="button is-link add_detail_task" style="width: 100%;" title="提交到看板(片)娘">\n            <span class="icon is-small">\n              <i class="icon-heart-o"></i>\n            </span>\n            <span>提交到看板(片)娘</span>\n</button>'),$("#magnets-content > .item >.buttons").append('\n<div class="panel-block">\n<button class="button is-link add_aria2_task" title="提交到看板(片)娘">\n            <span class="icon is-small">\n              <i class="icon-heart-o"></i>\n            </span>\n            <span>看板(片)娘aria2下载</span>\n</button>\n</div>'),$("#add_list_task").click(add_list_task),$(".add_detail_task").click(add_detail_task),$(".add_aria2_task").click((t=>{const a=$(t.target).parents("#magnets-content > .item").children(".magnet-name").children("a");add_aria2_task(a.attr("href"),`${$(".video-meta-panel .panel-block.first-block > .value").text().trim()}_${$(".video-detail .title .current-title").text().trim()}`,a.children(".name").text(),window.location.href)}));